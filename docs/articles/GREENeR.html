<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GREENeR">
<title>Geospatial Regression Equation for European Nutrient losses (GREEN) • GREENeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Geospatial Regression Equation for European Nutrient losses (GREEN)">
<meta property="og:description" content="GREENeR">
<meta property="og:image" content="https://calfarog.github.io/GREENeR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GREENeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/GREENeR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/calfarog/GREENeR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Geospatial Regression Equation for European Nutrient losses (GREEN)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/calfarog/GREENeR/blob/HEAD/vignettes/GREENeR.Rmd" class="external-link"><code>vignettes/GREENeR.Rmd</code></a></small>
      <div class="d-none name"><code>GREENeR.Rmd</code></div>
    </div>

    
    
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script><style>
body {
text-align: justify}
</style>
<hr>
<p><strong>This Vignette illustrates how to use the GREENeR package for
assessing annual time series of nutrient (total nitrogen TN and total
phosphorus TP) loads in surface water from a basin or region of
interest, including assessing land and river retention, and contribution
shares by source.</strong></p>
<div class="section level3">
<h3 id="description-of-the-tool">Description of the tool<a class="anchor" aria-label="anchor" href="#description-of-the-tool"></a>
</h3>
<p>GREENeR <span class="citation">(Udías et al. 2024)</span> is an
open-source R package for assessing annual time series of nutrient loads
in a river network and at the basin outlets, and contributions of
nutrient sources to these loads. The package provides tools and methods
to apply the model Geospatial Regression Equation for European Nutrient
losses (GREEN; <span class="citation">(B. Grizzetti et al. 2005; B.
Grizzetti, Bouraoui, and De Marsily 2008; Bruna Grizzetti, Bouraoui, and
Aloe 2012; Bruna Grizzetti et al. 2021)</span>) to an area of interest.
A brief description of the model, including sources and parameters, can
be found at the end of this document.</p>
<p>The package includes functions to perform graphical summaries of
model inputs, calibrate model parameters, run sensitivity analysis
checks, and visualize model inputs and outputs through graphs and maps
of total loads and contributions by source. The package works for both
total nitrogen (TN) and total phosphorus (TP). It allows the analysis of
different scenarios of nutrient input in the river basin or region of
study. The package is parallel-capable to alleviate the computational
burden in large basins.</p>
</div>
<div class="section level3">
<h3 id="an-example-case-the-lay-river-basin">An example case: the Lay river Basin<a class="anchor" aria-label="anchor" href="#an-example-case-the-lay-river-basin"></a>
</h3>
<p>GREENeR functionalities are illustrated for the <a href="https://en.wikipedia.org/wiki/Lay_(river)" class="external-link">Lay river</a> basin, in
France. Please note that the basin data are extracted from a
pan-European dataset <span class="citation">(Bruna Grizzetti et al.
2021)</span> for the purpose of showing the package tools and the
analysis steps for a generic region. Since the dataset may not reflect
local sources correctly, implications of results in terms of nutrient
fluxes may be incorrect and are not evaluated nor commented herein.</p>
<p>The package includes two nutrient type scenarios (one for TN and one
for TP), with disaggregated information on nutrient inputs for all
catchments that compose the basin (spatial resolution of the Catchment
Characterisation Model; <span class="citation">(De Jager and Vogt
2007)</span>). Both input (TN and TP) time series span from 1990 to
2018. The dataset includes also spatial information in vectorial format
to enable mapping of tool results.</p>
</div>
<div class="section level3">
<h3 id="loading-and-description-of-the-scenario">Loading and description of the scenario<a class="anchor" aria-label="anchor" href="#loading-and-description-of-the-scenario"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the GREENeR package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/calfarog/GREENeR" class="external-link">GREENeR</a></span><span class="op">)</span></span></code></pre></div>
<p>GreeneR needs information on the topology of the catchment and
nutrient sources. All information is contained in two data.frames.
<strong>Note that data.frame structures and column names must be
respected when creating a new dataset, otherwise the functions will
fail.</strong></p>
<p>The topology is contained in the data.frame “<em>catch_data_TN</em>”
(<em>or catch_data_TP</em>; in the example dataset, the Lay river Basin
topology is presented).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the topological sequence of catchments and complementary info</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">catch_data_TN</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">catch_data_TN</span><span class="op">)</span></span>
<span><span class="co">#&gt;     HydroID To_catch Shreve LakeFrRet NrmLengthKm</span></span>
<span><span class="co">#&gt; 1    361076   361195      1         0    0.010270</span></span>
<span><span class="co">#&gt; 28   361521   362009      4         0    0.059295</span></span>
<span><span class="co">#&gt; 55   362311   362426      2         0    0.011319</span></span>
<span><span class="co">#&gt; 84   361187   361195      2         0    0.011948</span></span>
<span><span class="co">#&gt; 109  361383   361521      1         0    0.005731</span></span>
<span><span class="co">#&gt; 136  362149   362175      1         0    0.002374</span></span></code></pre></div>
<p>The fields are defined as follow:</p>
<ul>
<li><p>HydroID (integer): unique identifier of the catchment</p></li>
<li><p>To_catch (integer): unique identifier of the catchment to which
the catchment goes. Note that for the outlet To_catch == -1</p></li>
<li><p>Shreve (integer positive): this indicates the Shreve order of the
topological sequence in the stream network. GREEN resolves sequentially
all loads for increasing numbers of Shreve order (headwaters,
i.e. catchments that do not receive water, are Shreve == 1, catchments
that receive waters only from Shreve 1 are Shreve == 2, etc till the
outlet)</p></li>
<li><p>LakeFrRet (fraction, 0-1): lake retention fraction (Lret in eqs
1, 6, 7). Note, this is different for TN or TP module</p></li>
<li><p>NrmLengthKm (double): normalized length of catchment reach (eq
5)</p></li>
</ul>
<p>The nutrient sources in each catchment per year are contained in the
data.frame “<em>annual_data_TN</em>” for the TN scenario
(“<em>annual_data_TP</em>” for the TP scenario).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the sources of TN for each year and catchment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">annual_data_TN</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">annual_data_TN</span><span class="op">)</span></span>
<span><span class="co">#&gt;   BasinID YearValue HydroID NextDownID   Atm    Min    Man   Fix  Soil    Sd</span></span>
<span><span class="co">#&gt; 1  291994      1990  361076     361195 9.608 28.111 21.379 2.909 2.108 0.514</span></span>
<span><span class="co">#&gt; 2  291994      1991  361076     361195 9.608 28.295 20.318 2.888 2.108 0.589</span></span>
<span><span class="co">#&gt; 3  291994      1992  361076     361195 9.608 26.482 21.514 2.917 2.108 0.665</span></span>
<span><span class="co">#&gt; 4  291994      1993  361076     361195 9.608 24.060 19.861 2.868 2.108 0.741</span></span>
<span><span class="co">#&gt; 5  291994      1994  361076     361195 9.608 23.725 20.199 2.890 2.108 0.816</span></span>
<span><span class="co">#&gt; 6  291994      1995  361076     361195 9.608 24.271 21.772 2.830 2.108 0.892</span></span>
<span><span class="co">#&gt;      Ps YearlyMass ForestFraction InvNrmRain</span></span>
<span><span class="co">#&gt; 1 0.314         NA      0.1700787   0.081113</span></span>
<span><span class="co">#&gt; 2 0.251         NA      0.1700787   0.075192</span></span>
<span><span class="co">#&gt; 3 0.188         NA      0.1700787   0.069081</span></span>
<span><span class="co">#&gt; 4 0.126         NA      0.1700787   0.066110</span></span>
<span><span class="co">#&gt; 5 0.063         NA      0.1700787   0.047314</span></span>
<span><span class="co">#&gt; 6 0.000         NA      0.1700787   0.061390</span></span>
<span></span>
<span><span class="co"># load the sources of TP for each year and catchment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">annual_data_TP</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">annual_data_TP</span><span class="op">)</span></span>
<span><span class="co">#&gt;   BasinID YearValue HydroID NextDownID    Bg   Min   Man    Sd    Ps YearlyMass</span></span>
<span><span class="co">#&gt; 1  291994      1990  361187     361195 0.082 8.577 3.108 0.330 0.315         NA</span></span>
<span><span class="co">#&gt; 2  291994      1991  361187     361195 0.082 8.300 2.819 0.319 0.300         NA</span></span>
<span><span class="co">#&gt; 3  291994      1992  361187     361195 0.082 7.688 3.393 0.307 0.285         NA</span></span>
<span><span class="co">#&gt; 4  291994      1993  361187     361195 0.082 6.614 3.660 0.296 0.270         NA</span></span>
<span><span class="co">#&gt; 5  291994      1994  361187     361195 0.082 6.119 4.508 0.284 0.256         NA</span></span>
<span><span class="co">#&gt; 6  291994      1995  361187     361195 0.082 6.025 4.676 0.273 0.241         NA</span></span>
<span><span class="co">#&gt;   ForestFraction InvNrmRain</span></span>
<span><span class="co">#&gt; 1              0   0.081765</span></span>
<span><span class="co">#&gt; 2              0   0.075672</span></span>
<span><span class="co">#&gt; 3              0   0.068371</span></span>
<span><span class="co">#&gt; 4              0   0.066009</span></span>
<span><span class="co">#&gt; 5              0   0.047398</span></span>
<span><span class="co">#&gt; 6              0   0.061488</span></span></code></pre></div>
<p>In the annual data frames some fields are in common:</p>
<ul>
<li>
<em>BasinID</em> (integer): unique identifier of the Basin. This may
be useful when the region of interest encompasses more than one basin;
all catchments belonging to a same Basin share the same BasinID.</li>
<li>
<em>YearValue</em> (integer): the year for which data are
defined</li>
<li>
<em>HydroID</em> (integer positive): unique catchment identifier
(matches the ID in catch_data)</li>
<li>
<em>NextDownID</em> (integer positive): corresponds to To_catch</li>
<li>
<em>ForestFraction</em>: Non-agricultural land cover in the
catchment (fraction, FF in eqs 6 and 7)</li>
<li>
<em>InvNrmRain</em>: inverse of normalized rainfall (eq 4)</li>
<li>
<em>YearlyNMass</em>: observed annual total nitrogen load (TN
ton/yr) from monitoring station data where available (NA when no data is
present for that catchment and year). These data allow calibration of
model parameter; thus sufficient observed loads are essential for the
calibration process.</li>
</ul>
<p>The other fields specify nutrient sources, and differs in the two
nutrient scenarios. In the case of TN, fields are:</p>
<ul>
<li>Atm: Annual nitrogen deposition from atmosphere (ton/yr)</li>
<li>Min: Annual amount of nitrogen from mineral fertilisers
(ton/yr)</li>
<li>Man: Annual amount of nitrogen in manure fertilisers (ton/yr)</li>
<li>Fix: Annual amount of nitrogen fixation by leguminous crops and
fodder (ton/yr)</li>
<li>Soil: Annual amount of nitrogen fixation by bacteria in soils
(ton/yr)</li>
<li>Sd: Nitrogen input from scattered dwellings (ton/yr)</li>
<li>Ps: Nitrogen input from point sources (ton/yr)</li>
</ul>
<p>In the case of TP fields are:</p>
<ul>
<li>Bg: annual amount of phosphorus background losses (ton/yr; eq
7)</li>
<li>Min: annual amount of phosphorus mineral fertilisers (ton/yr)</li>
<li>Man: annual amount of phosphorus in manure fertilisers (ton/yr)</li>
<li>Sd: phosphorus input from scattered dwellings (ton/yr)</li>
<li>Ps: phosphorus input from point sources (ton/yr)</li>
</ul>
<p>For some functionalities of the GREENeR package, the geographical
information of the catchments is required in the form of an sf (simple
feature) object (the sf package, Pebesma &amp; Bivand, implements the
Simple Features open standard)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the geographical information of the basin (require for some functionalities)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sh_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sh_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 14 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 3440600 ymin: 2645700 xmax: 3476900 ymax: 2691300</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89-extended / LAEA Europe</span></span>
<span><span class="co">#&gt;   OBJECTID HydroID NextDownID BasinID JunctionID AreaSqkm DrainAreaS Shreve</span></span>
<span><span class="co">#&gt; 1    71204  368447         -1  291994   20837332    43.68    1971.10     95</span></span>
<span><span class="co">#&gt; 2   350329  362484     362498  291994   33061724     0.58       0.58      1</span></span>
<span><span class="co">#&gt; 3   350337  368467     368429  291994   33061732    21.37      21.37      1</span></span>
<span><span class="co">#&gt; 4   350345  362497     362454  291994   33061740    25.52      25.52      1</span></span>
<span><span class="co">#&gt; 5   350346  362499     362498  291994   33061741     0.03     158.18      8</span></span>
<span><span class="co">#&gt; 6   350347  362498     362537  291994   33061742     1.44     160.20      9</span></span>
<span><span class="co">#&gt;     FecID   CsbID SuppID  Csb0ID Shape_STAr Shape_STLe</span></span>
<span><span class="co">#&gt; 1 6031419 7000265  71204 7100074   43680000      59800</span></span>
<span><span class="co">#&gt; 2 6031445 7000265 350329 7100074     580000       3600</span></span>
<span><span class="co">#&gt; 3 6031420 7000265 350337 7100074   21370000      32600</span></span>
<span><span class="co">#&gt; 4 6031450 7000265 350345 7100074   25520000      36400</span></span>
<span><span class="co">#&gt; 5 6031445 7000265 350346 7100074      30000        800</span></span>
<span><span class="co">#&gt; 6 6031445 7000265 350347 7100074    1440000       8000</span></span>
<span><span class="co">#&gt;                         geometry</span></span>
<span><span class="co">#&gt; 1 MULTIPOLYGON (((3447500 264...</span></span>
<span><span class="co">#&gt; 2 MULTIPOLYGON (((3476600 268...</span></span>
<span><span class="co">#&gt; 3 MULTIPOLYGON (((3440600 265...</span></span>
<span><span class="co">#&gt; 4 MULTIPOLYGON (((3458000 268...</span></span>
<span><span class="co">#&gt; 5 MULTIPOLYGON (((3476700 268...</span></span>
<span><span class="co">#&gt; 6 MULTIPOLYGON (((3476000 269...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exploring-scenario-inputs">Exploring scenario inputs<a class="anchor" aria-label="anchor" href="#exploring-scenario-inputs"></a>
</h3>
<p>The library includes functions to examine the nutrient sources in a
Basin, and explore how these are applied, either globally, or
distributed over time or in space.</p>
<p>A first summary is provided by the <code><a href="../reference/input_plot.html">input_plot()</a></code>
function, which - when option “B” is given, shows the mean annual
nutrient loads per source for the whole period of analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the barplot for the Lay TN and TP Scenarios</span></span>
<span><span class="fu"><a href="../reference/input_plot.html">input_plot</a></span><span class="op">(</span><span class="va">annual_data_TN</span>, <span class="va">sh_file</span>, <span class="st">"Lay"</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/input_plot.html">input_plot</a></span><span class="op">(</span><span class="va">annual_data_TP</span>, <span class="va">sh_file</span>, <span class="st">"Lay"</span>, <span class="st">"B"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/barplot_LayTN.png" alt="Barplot for the Lay TN scenario." width="100%"><p class="caption">
Barplot for the Lay TN scenario.
</p>
</div>
<div class="figure">
<img src="figures/barplot_LayTP.png" alt="Barplot for the Lay TP scenario." width="100%"><p class="caption">
Barplot for the Lay TP scenario.
</p>
</div>
<p>By selecting option “D”, <code><a href="../reference/input_plot.html">input_plot()</a></code> returns density
plots of nutrient loads per catchment. These are useful to see the
distribution of nutrient source inputs in the Basin. The
<code>coef_SD</code> parameter is a scale factor for the standard
deviation of the data. This can be useful for defining the limits on a
graph, for example. If cSD is 2, then <code>xlim</code> will be
calculated as the mean plus two standard deviations, which could
represent, for example, 95% of the data in a normal distribution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the density plots for the Lay TN and TP Scenarios</span></span>
<span><span class="fu"><a href="../reference/input_plot.html">input_plot</a></span><span class="op">(</span><span class="va">annual_data_TN</span>, <span class="st">"Lay"</span>, <span class="st">"D"</span>,coef_SD<span class="op">=</span><span class="fl">1</span>, <span class="va">sh_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/input_plot.html">input_plot</a></span><span class="op">(</span><span class="va">annual_data_TP</span>, <span class="st">"Lay"</span>, <span class="st">"D"</span>,coef_SD<span class="op">=</span><span class="fl">1</span>, <span class="va">sh_file</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/densityplot_LayTN.png" alt="Density plot for the Lay TN scenario." width="100%"><p class="caption">
Density plot for the Lay TN scenario.
</p>
</div>
<div class="figure">
<img src="figures/densityplot_LayTP.png" alt="Density plot for the Lay TP scenario." width="100%"><p class="caption">
Density plot for the Lay TP scenario.
</p>
</div>
<p>The function <code><a href="../reference/input_Tserie.html">input_Tserie()</a></code> allows to examine the
temporal evolution of the inputs. There are two options, the first,
displaying cumulative total amounts by source (“gr1”).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the time serie plot type 1 (areas)</span></span>
<span><span class="fu"><a href="../reference/input_Tserie.html">input_Tserie</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="st">"Lay"</span>, <span class="st">"gr1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/input_Tserie.html">input_Tserie</a></span><span class="op">(</span><span class="va">catch_data_TP</span>, <span class="va">annual_data_TP</span>, <span class="st">"Lay"</span>, <span class="st">"gr1"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/timeserieTN_type1.png" alt="Time series plot type 1 (areas) for TN and TP." width="45%" height="25%"><img src="figures/timeserieTP_type1.png" alt="Time series plot type 1 (areas) for TN and TP." width="45%" height="25%"><p class="caption">
Time series plot type 1 (areas) for TN and TP.
</p>
</div>
<p>The second, total amounts and by source total amount(“gr2”)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the time serie plot type 2 (lines)</span></span>
<span><span class="fu"><a href="../reference/input_Tserie.html">input_Tserie</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>,  <span class="st">"Lay"</span>, <span class="st">"gr2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/input_Tserie.html">input_Tserie</a></span><span class="op">(</span><span class="va">catch_data_TP</span>, <span class="va">annual_data_TP</span>,  <span class="st">"Lay"</span>, <span class="st">"gr2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/timeserieTN_type2.png" alt="Time series plot type 2 (lines) for TN and TP." width="45%" height="25%"><img src="figures/timeserieTP_type2.png" alt="Time series plot type 2 (lines) for TN and TP." width="45%" height="25%"><p class="caption">
Time series plot type 2 (lines) for TN and TP.
</p>
</div>
<p>The function <code><a href="../reference/input_Tserie_area.html">input_Tserie_area()</a></code> allows to examine the
temporal evolution of the inputs in relation to the area. There are also
two options, the first, displaying cumulative total amounts by source
per unit area (“gr1”)</p>
<div class="figure" style="text-align: center">
<img src="figures/timeserieTN_type3.png" alt="Time series plot type 3 (areas by year and km2) for TN and TP." width="45%" height="25%"><img src="figures/timeserieTP_type3.png" alt="Time series plot type 3 (areas by year and km2) for TN and TP." width="45%" height="25%"><p class="caption">
Time series plot type 3 (areas by year and km2) for TN and TP.
</p>
</div>
<p>The latter graph is particularly useful when the range of catchment
areas is large to compare nutrient application intensity between
catchments. In the Lay river example, these graphs show, among other
things, how the amount of P from mineral fertilization (Min) has
decreased over time, whereas the amount of P from manure has
increased.</p>
<p>There is a second alternative for the function
<code>input_Tseries_area()</code>, “gr2”. This option compares the
levels of nutrient inputs in three zones of the basin (upper, middle and
lower part). The upper zone includes the catchments up to the median
(50%) shreve value, the middle zone includes the catchments from 50% to
75% of the shreve values, and the lower part includes the catchments
from 75% to 100%. At the top of each graph, the corresponding area of
each part is indicated. In the example below, it can be seen that
differences in N inputs between the upper and lower part of the basin
are noticeable over the whole period.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the time serie plot type 4 (by km2 and Shreve)</span></span>
<span><span class="fu"><a href="../reference/input_Tserie_area.html">input_Tserie_area</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">sh_file</span>, <span class="st">"Lay"</span>, <span class="st">"gr2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/input_Tserie_area.html">input_Tserie_area</a></span><span class="op">(</span><span class="va">catch_data_TP</span>, <span class="va">annual_data_TP</span>, <span class="va">sh_file</span>, <span class="st">"Lay"</span>, <span class="st">"gr2"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figures/timeserieTN_type4.png" alt="Time series plot type 4, thatcompares the levels of nutrient inputs in three zones of the basin." width="45%" height="25%"><img src="figures/timeserieTP_type4.png" alt="Time series plot type 4, thatcompares the levels of nutrient inputs in three zones of the basin." width="45%" height="25%"><p class="caption">
Time series plot type 4, thatcompares the levels of nutrient inputs in
three zones of the basin.
</p>
</div>
<p>The function <code><a href="../reference/input_maps.html">input_maps()</a></code> shows nutrient inputs
distribution in the Basin. The function generates a map for each
nutrient source, plus a map (in yellow-green scale) of the total diffuse
nutrient sources, which can be contrasted to the point sources map. The
first option (“gr1”) shows total inputs (kt/year).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the Input Load Map by source type 1 (kt/year)</span></span>
<span><span class="fu"><a href="../reference/input_maps.html">input_maps</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">sh_file</span>, <span class="st">"gr1"</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/input_mapsTN_type1.png" alt="Input map by source type 1 for TN scenario" width="100%"><p class="caption">
Input map by source type 1 for TN scenario
</p>
</div>
<p>The legend_position parameter allows you to modify the position where
the legend will be located in the figure. For the TP scenario:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the Input Load Map by source type 1 (kt/year)</span></span>
<span><span class="fu"><a href="../reference/input_maps.html">input_maps</a></span><span class="op">(</span><span class="va">catch_data_TP</span>, <span class="va">annual_data_TP</span>, <span class="va">sh_file</span>, <span class="st">"gr1"</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/input_mapsTP_type1.png" alt="Input map by source type 1 for TP scenario" width="100%"><p class="caption">
Input map by source type 1 for TP scenario
</p>
</div>
<p>Option “gr2” shows inputs per area (in kt/y/km2):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the Input Load Map by source type 2 (kt/y/km2)</span></span>
<span><span class="fu"><a href="../reference/input_maps.html">input_maps</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">sh_file</span>, <span class="st">"gr2"</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/input_mapsTN_type2.png" alt="Input map by source type 2 for TN scenario" width="100%"><p class="caption">
Input map by source type 2 for TN scenario
</p>
</div>
<p>For the TP scenario:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the Input Load Map by source type 2 (kt/y/km2)</span></span>
<span><span class="fu"><a href="../reference/input_maps.html">input_maps</a></span><span class="op">(</span><span class="va">catch_data_TP</span>, <span class="va">annual_data_TP</span>, <span class="va">sh_file</span>, <span class="st">"gr2"</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/input_mapsTP_type2.png" alt="Input map by source type 2 for TP scenario" width="100%"><p class="caption">
Input map by source type 2 for TP scenario
</p>
</div>
</div>
<div class="section level3">
<h3 id="lake-retention">Lake Retention<a class="anchor" aria-label="anchor" href="#lake-retention"></a>
</h3>
<p>In the Lake Retention section, we note that the scenarios for TN or
TP are also linked with information about lake retention. This data is
often not dependent on the model used to generate the scenario and
includes actual field data. Therefore, viewing the distribution of lake
retention data can be insightful because it directly impacts the
outcomes of the entire GREEN model. The function that carries out this
analysis is <code><a href="../reference/LakeRetent_plot.html">LakeRetent_plot()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LakeRetent_plot.html">LakeRetent_plot</a></span><span class="op">(</span><span class="va">catch_data_TN</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/LakeRetent_plot.png" alt="Lake retention values distribution for TN scenario" width="100%"><p class="caption">
Lake retention values distribution for TN scenario
</p>
</div>
</div>
<div class="section level3">
<h3 id="observed-load">Observed Load<a class="anchor" aria-label="anchor" href="#observed-load"></a>
</h3>
<p>Under the Observed Load section, we discuss the importance of
information on the annual total nitrogen load (TN ton/yr) or total
phosphorous (TN ton/yr) gathered from monitoring station data, wherever
available. If no data is available for a particular catchment and year,
it is noted as NA. This information is crucial for the calibration
process of the model, as it allows the adjustment of model parameters.
Therefore, having a substantial amount of observed loads is essential
for the calibration process. The package includes a function called
<code><a href="../reference/references_plot.html">references_plot()</a></code>, which can be used to create a
preliminary summary of the data available at the monitoring stations.
Before diving into calibration it is thus useful to start by exploring
observations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TN_ref_values</span> <span class="op">&lt;-</span> <span class="va">annual_data_TN</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">annual_data_TN</span><span class="op">$</span><span class="va">YearlyMass</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">TN_ref_values</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">TN_ref_values</span><span class="op">$</span><span class="va">HydroID</span>,<span class="va">TN_ref_values</span><span class="op">$</span><span class="va">YearValue</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="../reference/references_plot.html">references_plot</a></span><span class="op">(</span><span class="va">annual_data_TN</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figures/references.png" alt="Observed references distribution for TN scenario" width="100%"><p class="caption">
Observed references distribution for TN scenario
</p>
</div>
<p>In the example basin there are 22 observations (derived from publicly
available dataset of European Environment Agency, <a href="https://www.eea.europa.eu/data-and-maps/data/waterbase-water-quality-icm-1" class="external-link">EEA</a>
for 6 different stations from 2003 to 2009; note however that only one
station has references for all years. (For the TP case there are 58
observations, collected in eight catchments from 1997 to 2012, with one
complete time-series).</p>
</div>
<div class="section level3">
<h3 id="model-calibration">Model calibration<a class="anchor" aria-label="anchor" href="#model-calibration"></a>
</h3>
<p>To run the calibration process for a scenario (function
<code><a href="../reference/calib_green.html">calib_green()</a></code>), the following settings must be defined:</p>
<ol>
<li>The expected range for each parameter. This range is defined by two
vectors of three values, one for the lower limits and one for the upper
limits of the three parameters. The values correspond to each of the
parameters of the model in sequence: alpha_P (eq 4), alpha_L (eq 5), and
sd_coeff (eqs 6 and 7).</li>
<li>The number of iterations to be performed during the calibration
process. The higher the number of iterations, the more likely it is to
achieve quality parameters, but the longer the computation time
required. Although it depends on the catchment and the proposed
intervals, it is recommended to run at least 200 iterations to have
enough information to continue the calibration process.</li>
<li>The years to be included in the calibration process.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameter for the calibration of the model</span></span>
<span><span class="co"># the lower limits for all params (alpha_P, alpha_L, sd_coef)</span></span>
<span><span class="va">low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.000</span>, <span class="fl">0.1</span><span class="op">)</span> </span>
<span><span class="co"># the upper limits for all params (alpha_P, alpha_L, sd_coef)  </span></span>
<span><span class="va">upp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">0.08</span>, <span class="fl">0.9</span><span class="op">)</span>       </span>
<span></span>
<span><span class="co"># number of iterations</span></span>
<span><span class="va">n_iter</span> <span class="op">&lt;-</span> <span class="fl">200</span> </span>
<span></span>
<span><span class="co"># years in which the model should be executed</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2003</span><span class="op">:</span><span class="fl">2009</span><span class="op">)</span></span></code></pre></div>
<p>In the example below, a calibration of TN in the Lay basin is
performed with the parameters indicated above. The process is
parallelised and will use all the cores of the computer. The computation
time depends on the computer, the basin, and the number of
iterations.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># execution of the calibration  </span></span>
<span><span class="va">DF_calib_TN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_green.html">calib_green</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">n_iter</span>, <span class="va">low</span>, <span class="va">upp</span>, <span class="va">years</span><span class="op">)</span></span>
<span><span class="va">DF_calib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">DF_calib</span><span class="op">)</span></span></code></pre></div>
<p>The calibration function applies a Latin Hypercube sampling scheme to
the three parameters within the possible range (defined by lower and
upper limits) and evaluates model performance (predictions against
available observations) for the calibration period (specified in
‘years’) by calculating several “goodness-of-fit” metrics. The function
returns a data frame with parameters and goodness-of-fit scores that can
be further analyzed.</p>
<p>The function applies the following goodness-of-fit metrics <span class="citation">(Althoff and Rodrigues 2021)</span>:</p>
<ul>
<li>NSE: Nash-Sutcliffe efficiency</li>
<li>rNSE: Relative Nash-Sutcliffe efficiency</li>
<li>mNSE: Modified Nash-Sutcliffe efficiency</li>
<li>cp: Coefficient of Persistence</li>
<li>VE: Volumetric Efficiency</li>
<li>KGE: Kling-Gupta efficiency</li>
<li>d: Index of Agreement</li>
<li>md: Modified index of agreement</li>
<li>rd: Relative Index of Agreement</li>
<li>r: Linear correlation coefficient</li>
<li>R2: Coefficient of determination</li>
<li>PBIAS: Percent bias</li>
<li>MAE: mean absolute error</li>
<li>RMSE: Root mean square error</li>
<li>ME: Mean error</li>
<li>MSE: Mean square error</li>
<li>NRMSE: Normalized Root Mean Square Error</li>
</ul>
</div>
<div class="section level3">
<h3 id="exploring-calibration-results">Exploring calibration results<a class="anchor" aria-label="anchor" href="#exploring-calibration-results"></a>
</h3>
<p>Choosing the right goodness-of-fit metric to select the best set of
parameters for a model largely depends on the overall study scope, the
area of interest (e.g. high or low load, upper or lower catchment area),
and the available observation dataset (size and quality). The library
includes a series of functions to examine the calibration results and
help select the most suitable set of parameters.</p>
<p>The <code><a href="../reference/calib_boxplot.html">calib_boxplot()</a></code> function shows relationships between
best parameter sets chosen according to one goodness-of-fit parameter
(title of each boxplot) according to one goodness-of-fit metric (title
of plot) in relation to others (x label). Only the six metrics that are
used most frequently in hydrological calibration are included in this
figure. In the lower panel, the figure shows as well the distribution of
model parameters in the best parameter sets. The absolute best parameter
set according to each goodness-of-fit metrics is marked as red dots in
each boxplot.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generating the box plots  </span></span>
<span><span class="va">rateBS</span> <span class="op">&lt;-</span>  <span class="fl">5</span>  <span class="co">#  percent of parameters selected from the whole calibration set</span></span>
<span><span class="fu"><a href="../reference/calib_boxplot.html">calib_boxplot</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">rateBS</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/calibration_boxplotTN.png" width="100%"></p>
<p>The <code><a href="../reference/calib_dot.html">calib_dot()</a></code> function shows the distribution of
parameters in relation to each other for a chosen goodness-of-fit
metric. With this function the figure can be generated for all the
previously described goodness-of-fit metrics.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generating the dot plots  </span></span>
<span><span class="va">Gof_mes</span> <span class="op">&lt;-</span> <span class="st">"NSE"</span></span>
<span><span class="fu"><a href="../reference/calib_dot.html">calib_dot</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">Gof_mes</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/calibration_dotTN.png" width="100%"></p>
<p>In the example figure, the best results for alpha_P to achieve best
NSE are in the range 0.25-0.30 (cyan color), while there are no clear
patterns for the other two parameters. Also, no significant interaction
between parameters can be appreciated. We can conclude that the most
sensitive parameter in this case is alpha_P.</p>
<p>The <code><a href="../reference/scatter_plot.html">scatter_plot()</a></code> function shows all parameter
realizations in the calibration dataset against a selected
goodness-of-fit metric to visualize the influence of each parameter on
model results. The result depends on the goodness-of-fit metric the user
wants to consider. With this function the figure can be generated for
all metrics generated by <code>green_calib()</code> function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generating the scatter plots  </span></span>
<span><span class="va">Gof_mes</span> <span class="op">&lt;-</span> <span class="st">"NSE"</span></span>
<span><span class="fu"><a href="../reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">Gof_mes</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/calibration_scatterTN.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="selecting-the-best-parameter-sets">Selecting the best parameter sets<a class="anchor" aria-label="anchor" href="#selecting-the-best-parameter-sets"></a>
</h3>
<p>The best parameter set according to a selected goodness-of-fit
metrics can be extracted with the <code><a href="../reference/select_params.html">select_params()</a></code>
function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Gof_mes</span> <span class="op">&lt;-</span> <span class="st">"NSE"</span> <span class="co"># according the NSE goodness of fit metric</span></span>
<span><span class="va">NSE_bestParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_params.html">select_params</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">Gof_mes</span><span class="op">)</span></span>
<span><span class="va">NSE_bestParams</span></span>
<span><span class="va">Param_NSE2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">NSE_bestParams</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The function can be applied with different goodness-of-fit metric to
obtain different potential model realizations:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Gof_mes</span> <span class="op">&lt;-</span> <span class="st">"rNSE"</span> </span>
<span><span class="va">rNSE_bestParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_params.html">select_params</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>,<span class="va">Gof_mes</span><span class="op">)</span></span>
<span><span class="va">rNSE_bestParams</span>    </span>
<span><span class="va">Param_rNSE2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rNSE_bestParams</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>(note that actual values returned by the function could change at
each calibration run)</p>
</div>
<div class="section level3">
<h3 id="annual-observed-vs-predicted-values-for-a-parameter-set">Annual observed vs predicted values for a parameter set<a class="anchor" aria-label="anchor" href="#annual-observed-vs-predicted-values-for-a-parameter-set"></a>
</h3>
<p>Once a parameter set has been selected, it is useful to verify
graphically the differences between the observations (ObsLoad) and the
model predictions (PredictLoad). Included in the tool is the function
<code><a href="../reference/simobs_annual_plot.html">simobs_annual_plot()</a></code>, which allows a year-to-year
comparison of observed and predicted values for a given parameter
sets.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># annual scatter plot comparing observed vs modeled loads by year</span></span>
<span><span class="va">label_plot</span> <span class="op">&lt;-</span> <span class="st">"NSE best params for TN in the Lay"</span> </span>
<span><span class="va">Themx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">annual_data_TN</span><span class="op">$</span><span class="va">YearlyMass</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/simobs_annual_plot.html">simobs_annual_plot</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">years</span>, <span class="va">label_plot</span>, <span class="va">Themx</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/annual_scatter_vs_modeled_loadsTN.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="comparing-observed-vs-predicted-for-two-sets-of-parameters">Comparing Observed vs Predicted for two sets of parameters<a class="anchor" aria-label="anchor" href="#comparing-observed-vs-predicted-for-two-sets-of-parameters"></a>
</h3>
<p>The best parameter set depends on the goodness-of-fit metric. It is
advisable to pre-select alternative parameter sets (according to
different GoF) and compare model results, before making the final
selection of the parameter set. The <code><a href="../reference/compare_calib.html">compare_calib()</a></code>
function shows simultaneously all observations against modelled values
obtained from two parameter sets.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setPlabels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSE"</span>, <span class="st">"rNSE"</span><span class="op">)</span>    </span>
<span><span class="va">label_plot</span> <span class="op">&lt;-</span> <span class="st">"Comparing two sets of parameters for Lay TN"</span> </span>
<span><span class="fu"><a href="../reference/compare_calib.html">compare_calib</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">Param_rNSE2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Param_rNSE2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">Param_rNSE2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">years</span>, <span class="va">label_plot</span>, <span class="va">setPlabels</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/comparing_twosets_paramsTN.png" width="100%"></p>
<p>At the top left of the figure, the scores of six frequently used
goodness-of-fit metrics for the two parameter sets (as identified in
setPlabels) are reported.</p>
</div>
<div class="section level3">
<h3 id="estimation-of-nutrient-fluxes-and-source-contribution-in-the-basin">Estimation of nutrient fluxes and source contribution in the
basin<a class="anchor" aria-label="anchor" href="#estimation-of-nutrient-fluxes-and-source-contribution-in-the-basin"></a>
</h3>
<p>Once the most appropriate parameter set has been selected, it is
possible to run the model to estimate nutrient loads across the
basin.</p>
<p>The function <code><a href="../reference/region_nut_balance.html">region_nut_balance()</a></code> runs the GREEN model
with the selected parameter set, and returns the region nutrient mass
balance of the nutrient fluxes for the whole simulation period. The
results of this function can be visualized in a Sankey diagram with the
function <code><a href="../reference/N4_sankey.html">N4_sankey()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Computing the nutrient balance  </span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2003</span><span class="op">:</span><span class="fl">2009</span><span class="op">)</span></span>
<span><span class="va">Nut_bal_TN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_nut_balance.html">region_nut_balance</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">years</span>, atm_coeff <span class="op">=</span> <span class="fl">0.38</span><span class="op">)</span></span>
<span><span class="co"># Plot the sankey plot with the result of the balance</span></span>
<span><span class="va">sank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/N4_sankey.html">N4_sankey</a></span><span class="op">(</span><span class="va">Nut_bal_TN</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/n4sankey.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="share-of-nutrients">Share of nutrients<a class="anchor" aria-label="anchor" href="#share-of-nutrients"></a>
</h3>
<p>The function <code><a href="../reference/green_shares.html">green_shares()</a></code> runs the GREEN model with
the selected parameter set and returns for all catchments nutrient loads
and contributions by each nutrient source in the simulation period.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2003</span><span class="op">:</span><span class="fl">2009</span><span class="op">)</span></span>
<span><span class="va">basin_sa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/green_shares.html">green_shares</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">Param_NSE2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">years</span><span class="op">)</span></span></code></pre></div>
<p>The results of the model can be examined by several functions. The
function <code>nutrient_tseries()</code> allows to display the time
series of the total load (TN or TP) in the river outlet or the marian
region. The <em>“gr1”</em> option shows the temporal evolution of the
total load at the basin outlet in the simulation period.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The title of the plot</span></span>
<span><span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="st">"Time series Load Output for the Lay Basin"</span>    </span>
<span><span class="va">outFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"OutletLoad"</span>, fileext <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/nutrient_tserie.html">nutrient_tserie</a></span><span class="op">(</span><span class="va">basin_sa</span>, <span class="va">plot_title</span>, <span class="st">"gr1"</span>, <span class="va">outFile</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/timeserie_loadoutputLay_type1.png" width="100%"></p>
<p>The <em>“gr2”</em> option shows the temporal evolution of the total
load at the basin outlet in the simulation period with contributions by
sources.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Output Load Basin average time series (lines)</span></span>
<span><span class="fu"><a href="../reference/nutrient_tserie.html">nutrient_tserie</a></span><span class="op">(</span><span class="va">basin_sa</span>, <span class="va">plot_title</span>, <span class="st">"gr2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/timeserie_loadoutputLay_type2.png" width="100%"></p>
<p>The function <code><a href="../reference/nutrient_tserie_darea.html">nutrient_tserie_darea()</a></code>, with the option
<em>“gr1”</em>, shows the temporal evolution of total load outputs for
the upper, central and lower catchment area.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Total Load in the Basin Outlet by source apportionment time series (lines)</span></span>
<span><span class="fu"><a href="../reference/nutrient_tserie_darea.html">nutrient_tserie_darea</a></span><span class="op">(</span><span class="va">basin_sa</span>, <span class="va">sh_file</span>, <span class="st">"Lay Basin"</span>, <span class="st">"gr1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/timeserie_totalloadLay.png" width="100%"></p>
<p>The function <code><a href="../reference/nutrient_maps.html">nutrient_maps()</a></code> shows maps of nutrient
loads in the basin. The option <em>“gr1”</em> shows loads by source (in
logarithmic scale to improve the visualization as the differences in a
basin may vary over several orders of magnitude).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">style</span> <span class="op">&lt;-</span> <span class="st">"log10"</span> </span>
<span><span class="fu"><a href="../reference/nutrient_maps.html">nutrient_maps</a></span><span class="op">(</span><span class="va">basin_sa</span>, <span class="va">sh_file</span>, <span class="st">"gr1"</span>, <span class="va">style</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/nutrient_maps_outputLoadsType1.png" width="100%"></p>
<p>The “<strong><em>style</em></strong>” parameter allows the user to
automatically create breaks by specifying algorithms. Among others, the
following styles can be passed: “fisher”, “log10_pretty”, “log10”,
“order”, “cont”, “quantile”, “jenks”.</p>
<p>The alternative <em>“gr2”</em> shows the total load at catchment
outlets (in logarithmic scale to improve their visualisation, as the
differences between sources and outlets are usually several orders of
magnitude).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basin Output Total Load  Maps </span></span>
<span><span class="fu"><a href="../reference/nutrient_maps.html">nutrient_maps</a></span><span class="op">(</span><span class="va">basin_sa</span>, <span class="va">sh_file</span>, <span class="va">style</span>, <span class="st">"gr2"</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/nutrient_maps_outputLoadsType2.png" width="100%"></p>
<p>The alternative “gr3” produces maps of total load by catchment area
(in kt/km2/y) in the basin.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basin Output Specific Load by km2 Maps </span></span>
<span><span class="fu"><a href="../reference/nutrient_maps.html">nutrient_maps</a></span><span class="op">(</span><span class="va">basin_sa</span>, <span class="va">sh_file</span>, <span class="va">style</span>, <span class="st">"gr3"</span>, legend_position <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/nutrient_maps_outputLoadsType3.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="green-model-equations-sources-and-resources-for-input-data">GREEN model equations, sources and resources for input data<a class="anchor" aria-label="anchor" href="#green-model-equations-sources-and-resources-for-input-data"></a>
</h3>
<p>The Geospatial Regression Equation for European Nutrient losses
(GREEN; <span class="citation">B. Grizzetti et al. (2005)</span>; <span class="citation">B. Grizzetti, Bouraoui, and De Marsily (2008)</span>;
<span class="citation">Bruna Grizzetti, Bouraoui, and Aloe
(2012)</span>; <span class="citation">Bruna Grizzetti et al.
(2021)</span>) is a conceptual model to assess nutrient loads (total
nitrogen and total phosphorous) from a basin given diffuse and point
emissions to the land and river network. The model comprises two major
nutrient pathways: diffuse sources that undergo retention in the land
phase (basin retention) before reaching the stream, and point sources
that are directly discharged into surface waters. Once in the river
network, all sources are reduced by the in-stream retention (river
retention).</p>
<p>Diffuse sources include nutrient from mineral fertilisers, manure
application, nitrogen crop and soil fixation, inputs from scattered
dwellings (i.e. isolated houses and small agglomerations that are not
connected to sewerage systems), and nitrogen atmospheric deposition (for
nitrogen module) or background losses (for phosphorus module). Point
sources consist of urban and industrial wastewater discharges. Basin
retention is modelled as a decay function proportional to the inverse of
the total annual precipitation in the catchment; river retention is
estimated as a decay function proportional to the river length,
considered as a proxy for water residence time. In addition, lake
retention is simulated as a function of lakes residence time and average
depth.</p>
<p>The basin is divided into spatial subunits (called catchments), which
have a given area, a river reach, an in-let node, and an outlet node.
The catchments are topologically connected from basin heads to the
outlet in cascading sequence. The sequence of nutrient load accumulation
through the stream network is defined by <span class="citation">Shreve
(1966)</span> order. Nutrient input from the different sources, basin
and river retention are simulated in each small catchment and routed
through the river network. For each catchment i in the basin, the GREEN
nutrient load <span class="math inline">\(L_i\)</span> is estimated by
the general equation:</p>
<p><span class="math display">\[\begin{equation}
\label{eq:green_nutrient_load}
  L_i = (1 - Lret_i) * (DS_i * (1 - Bret_i) + PS_i + U_i) * (1 - Rret_i)
\end{equation}\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(L_i\)</span> = Nutrient load at the
catchment outlet (out-node) (ton/yr)</li>
</ul>
<p>Sources of nutrients are:</p>
<ol style="list-style-type: lower-roman">
<li>
<span class="math inline">\(DS_i\)</span> = Nutrient diffuse sources
in the catchment (ton/yr)</li>
<li>
<span class="math inline">\(PS_i\)</span> = Nutrient point sources
in the catchment (ton/yr)</li>
<li>
<span class="math inline">\(U_i\)</span> = Nutrient load from
upstream catchments (ton/yr)</li>
</ol>
<p>Sinks of nutrients are:</p>
<ol style="list-style-type: lower-roman">
<li>
<span class="math inline">\(Lret_i\)</span> = Lake retention
(fraction). Lret can be defined according to <span class="citation">Kronvang et al. (2004)</span>: <span class="math display">\[\begin{equation}
  Lret_i = 1 - \frac{1}{[1 + (\frac{7.3}{z}) * RT]} \text{(for
nitrogen)}
\end{equation}\]</span> <span class="math display">\[\begin{equation}
  Lret_i = 1 - \frac{1}{[1 + (\frac{26}{z}) * RT]} \text{(for
phosphorus)}
\end{equation}\]</span>
</li>
</ol>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(z\)</span> average lake depth (m),</li>
<li>
<span class="math inline">\(RT\)</span> = hydraulic residence time
(yr).</li>
</ul>
<p>At European scale, average lake depth and hydraulic residence time
can be obtained from HydroLAKES database (<a href="https://www.hydrosheds.org/pages/hydrolakes" class="external-link uri">https://www.hydrosheds.org/pages/hydrolakes</a>, <span class="citation">Messager et al. (2016)</span>).</p>
<ol start="2" style="list-style-type: lower-roman">
<li><p><span class="math inline">\(Bret_i\)</span> = Basin retention
(fraction): <span class="math display">\[\begin{equation}
\label{eq:basin_retention}
  Bret_i = 1 - \exp(-alpha_p * NrmInvRainy)
\end{equation}\]</span> where <span class="math inline">\(NrmInvRain\)</span> is the inverse of annual
precipitation (in mm) of year y, normalized by the maximum in the
dataset: <span class="math inline">\(NrmInvRain = (1 / precipitationy )
/ max(1 / precipitation))\)</span></p></li>
<li><p><span class="math inline">\(Rret_i\)</span> = River retention
(fraction): <span class="math display">\[\begin{equation}
  Rret_i = 1 - \exp(-alpha_l * NrmLengthKmi)
\end{equation}\]</span></p></li>
</ol>
<p>where <span class="math inline">\(NrmLengthKm\)</span> is the length
(in km) of the catchment reach, normalized by the maximum in the
dataset: <span class="math inline">\(NrmLengthKm\)</span> = (length of
catchment <span class="math inline">\(i\)</span> reach, in km) / <span class="math inline">\(max\)</span>(Reach length in the basin).</p>
<p>Thus, the inverse of precipitation and the river length are scaled by
maximum scaling <span class="citation">(Frank and Todeschini
1994)</span>. Note that in this way basin retention varies from year to
year according to annual precipitation, whereas river retention for a
given catchment is constant. The equation is applied sequentially from
the most upstream nodes to the outlet. The model parameters are:</p>
<ol>
<li>the basin retention coefficient (<span class="math inline">\(alpha_p\)</span>), which together with annual
precipitation in each catchment regulates nutrient retention of diffuse
sources <span class="math inline">\(\eqref{eq:basin_retention}\)</span>;</li>
<li>the river retention coefficient (<span class="math inline">\(alpha_l\)</span>), which regulates the river
retention per river km.</li>
<li>the fraction of domestic diffuse sources that reaches the stream
network (<span class="math inline">\(sd_{coef}\)</span>). Note that in
Europe the amount ot nturients from scattered dwellings is a minor
source of nutrients, therefore this parameter is not very sensitive, and
a fixed value of <span class="math inline">\(0.50\)</span> is
recommended. In other regions of the world however this may not be the
case, hence the model in GREENeR package defines this fraction as a
calibration parameter.</li>
</ol>
<p><span class="math inline">\(\eqref{eq:green_nutrient_load}\)</span>
defines the general GREEN function. However, diffuse and point sources
are defined differently for each nutrient module, i.e. nitrogen or
phosphorus. More specifically in GREEN <strong>nitrogen</strong> model,
for the total nitrogen load <span class="math inline">\(L_i\)</span> of
catchment <span class="math inline">\(i\)</span> is estimated as:</p>
<p><span class="math display">\[\begin{equation}
  L_i = (1 - Lret_i) * ((MinN_i + ManN_i + FixN_i + SoilN_i + (1 - FF_i)
* AtmN_i) * \\
  (1 - Bret_i) + 0.38 * FF_i * AtmN_i + sd_{coef} * SdN_i + PsN_i + U_i)
* (1 - Rret_i)
\end{equation}\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(MinN_i\)</span> = Annual amount of
nitrogen from mineral fertilisers (ton/yr)</li>
<li>
<span class="math inline">\(ManN_i\)</span> = Annual amount of
nitrogen in manure fertilisers (ton/yr)</li>
<li>
<span class="math inline">\(FixN_i\)</span> = Annual amount of
nitrogen fixation by leguminous crops and fodder (ton/yr)</li>
<li>
<span class="math inline">\(SoilN_i\)</span> = Annual amount of
nitrogen fixation by bacteria in soils (ton/yr)</li>
<li>
<span class="math inline">\(AtmN_i\)</span> = Annual nitrogen
deposition from atmosphere (ton/yr)</li>
<li>
<span class="math inline">\(FF_i\)</span> = Non-agricultural land
cover in the catchment (fraction)</li>
<li>
<span class="math inline">\(SdN_i\)</span> = Nitrogen input from
scattered dwellings (ton/yr)</li>
<li>
<span class="math inline">\(PsN_i\)</span> = Nitrogen input from
point sources (ton/yr)</li>
<li>
<span class="math inline">\(U_i\)</span> = Nitrogen load from
upstream catchments (ton/yr).</li>
</ul>
<p>Note that nitrogen atmospheric deposition losses are split into two
parts, i.e. inputs to agricultural land undergo the basin retention
(which includes also the crop uptake), while in all other areas (FF
fraction) they are reduced by a fixed rate, derived from the literature,
before entering into the stream. Background losses for nitrogen are thus
estimated as <span class="math inline">\(0.38 * FF * AtmN\)</span>. For
an atmospheric deposition of <span class="math inline">\(10\)</span>
kgN/ha this corresponds to a background of <span class="math inline">\(3.8\)</span> kgN/ha (in line with the values
reported by <span class="citation">Commission et al. (2004)</span>).</p>
<p>In GREEN <strong>phosphorus</strong> model, the total annual
phosphorus load <span class="math inline">\(L_i\)</span> of catchment
<span class="math inline">\(i\)</span> is estimated by the equation:
<span class="math display">\[\begin{equation}
L_i = (1 - Lret_i) * ((MinP_i + ManP_i + (1 - FF_i) * BgP_i) * (1 -
Bret_i) + FF_i * BgP_i + \\
sd_{coef} * SdP_i + PsP_i + U_i) * (1 - Rret_i)
\end{equation}\]</span></p>
<ul>
<li>
<span class="math inline">\(MinP_i\)</span> = annual amount of
phosphorus mineral fertilisers (ton/yr)</li>
<li>
<span class="math inline">\(ManP_i\)</span> = annual amount of
phosphorus in manure fertilisers (ton/yr)</li>
<li>
<span class="math inline">\(FF_i\)</span> = Non-agricultural land
cover in the catchment (fraction)</li>
<li>
<span class="math inline">\(BgP_i\)</span> = annual amount of
phosphorus background losses (ton/yr)</li>
<li>
<span class="math inline">\(SdP_i\)</span> = phosphorus input from
scattered dwellings (ton/yr)</li>
<li>
<span class="math inline">\(PsP_i\)</span> = phosphorus input from
point sources (ton/yr)</li>
<li>
<span class="math inline">\(U_i\)</span> = Phosphorus load from
upstream catchments (ton/yr)</li>
</ul>
<p>Note that phosphorous background losses are splited into two parts,
with the inputs to agricultural land undergoing basin retention, while
in all other areas (FF fraction) they are considered entering into the
stream. Background losses for phosphorus are estimated at <span class="math inline">\(0.15\)</span> kgP/ha (in line with the values
reported by <span class="citation">Commission et al. (2004)</span>).</p>
<p>Assembling input data for running the GREEN model is time consuming.
Data sources for application at European scale are described in <span class="citation">Bruna Grizzetti et al. (2021)</span>. Domestic sources
of nitrogen and phosphorus can also be found in <span class="citation">Vigiak et al. (2020)</span>.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-althoff2021goodness" class="csl-entry">
Althoff, Daniel, and Lineu Neiva Rodrigues. 2021. <span>“Goodness-of-Fit
Criteria for Hydrological Models: Model Calibration and Performance
Assessment.”</span> <em>Journal of Hydrology</em> 600: 126674.
</div>
<div id="ref-helsinki2004fourth" class="csl-entry">
Commission, Helsinki et al. 2004. <span>“The Fourth Baltic Sea Pollution
Load Compilation (PLC-4).”</span> <em>Baltic Sea Environment
Proceedings; Helsinki Commission: Helsinki, Finland</em> 93: 189.
</div>
<div id="ref-de2007rivers" class="csl-entry">
De Jager, A, and J Vogt. 2007. <span>“Rivers and Catchments of
Europe-Catchment Characterisation Model (CCM).”</span> <em>Http://Data.
Europa. Eu/89h/Fe1878e8-7541-4c66-8453-Afdae7469221</em>.
</div>
<div id="ref-frank1994data" class="csl-entry">
Frank, Ildiko E, and Roberto Todeschini. 1994. <em>The Data Analysis
Handbook</em>. Elsevier.
</div>
<div id="ref-grizzetti2008assessing" class="csl-entry">
Grizzetti, B, F Bouraoui, and G De Marsily. 2008. <span>“Assessing
Nitrogen Pressures on European Surface Water.”</span> <em>Global
Biogeochemical Cycles</em> 22 (4).
</div>
<div id="ref-grizzetti2005statistical" class="csl-entry">
Grizzetti, B, F Bouraoui, G De Marsily, and G Bidoglio. 2005. <span>“A
Statistical Method for Source Apportionment of Riverine Nitrogen
Loads.”</span> <em>Journal of Hydrology</em> 304 (1-4): 302–15.
</div>
<div id="ref-grizzetti2012changes" class="csl-entry">
Grizzetti, Bruna, Fayçal Bouraoui, and Alberto Aloe. 2012.
<span>“Changes of Nitrogen and Phosphorus Loads to European
Seas.”</span> <em>Global Change Biology</em> 18 (2): 769–82.
</div>
<div id="ref-grizzetti2021eu" class="csl-entry">
Grizzetti, Bruna, Olga Vigiak, Angel Udias, Alberto Aloe, Michela Zanni,
Faycal Bouraoui, Alberto Pistocchi, et al. 2021. <span>“How EU Policies
Could Reduce Nutrient Pollution in European Inland and Coastal
Waters.”</span> <em>Global Environmental Change</em> 69: 102281.
</div>
<div id="ref-kronvang2004nutrient" class="csl-entry">
Kronvang, B, J Hezlar, P Boers, JP Jensen, H Behrendt, T Anderson, B
Arheimer, M Venohr, CC Hoffmann, and CB Nielsen. 2004. <span>“Nutrient
Retention Handbook.”</span> <em>Software Manual for EUROHARP-NUTRET and
Scientific Review on Nutrient Retention. EUROHARP Report</em>, 9–2004.
</div>
<div id="ref-messager2016estimating" class="csl-entry">
Messager, Mathis Loı̈c, Bernhard Lehner, Günther Grill, Irena Nedeva, and
Oliver Schmitt. 2016. <span>“Estimating the Volume and Age of Water
Stored in Global Lakes Using a Geo-Statistical Approach.”</span>
<em>Nature Communications</em> 7 (1): 1–11.
</div>
<div id="ref-shreve1966statistical" class="csl-entry">
Shreve, Ronald L. 1966. <span>“Statistical Law of Stream
Numbers.”</span> <em>The Journal of Geology</em> 74 (1): 17–37.
</div>
<div id="ref-RJ-2023-065" class="csl-entry">
Udías, Angel, Bruna Grizzetti, Olga Vigiak, Alberto Aloe, Cesar Alfaro,
and Javier Gomez. 2024. <span>“GREENeR: An r Package to Estimate and
Visualize Nutrients Pressures on Surface Waters.”</span> <em>The R
Journal</em> 15: 119–37. <a href="https://doi.org/10.32614/RJ-2023-065" class="external-link">https://doi.org/10.32614/RJ-2023-065</a>.
</div>
<div id="ref-vigiak2020domestic" class="csl-entry">
Vigiak, Olga, Bruna Grizzetti, Michela Zanni, Alberto Aloe, Chiara
Dorati, Fayçal Bouraoui, and Alberto Pistocchi. 2020. <span>“Domestic
Waste Emissions to European Waters in the 2010s.”</span> <em>Scientific
Data</em> 7 (1): 1–13.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by A. Udias, B. Grizzetti, O. Vigiak, J. Gomez, C. Alfaro, A. Aloe.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
