<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R Geospatial Regression Equation for European Nutrient Losses (GREEN) • GREENeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="R Geospatial Regression Equation for European Nutrient Losses (GREEN)">
<meta property="og:description" content="Tools and methods to apply the model Geospatial Regression Equation
    for European Nutrient losses (GREEN); 
    Grizzetti et al. (2005) &lt;doi:10.1016/j.jhydrol.2004.07.036&gt;; 
    Grizzetti et al. (2008) &lt;doi:10.1029/2007GB003085&gt;;
    Grizzetti et al. (2012) &lt;doi:10.1111/j.1365-2486.2011.02576.x&gt;; 
    Grizzetti et al. (2021) &lt;doi:10.1016/j.gloenvcha.2021.102281&gt;. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">GREENeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/GREENeR.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/calfarog/GREENeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="greener">GREENeR<a class="anchor" aria-label="anchor" href="#greener"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of GREENeR is to provide a conceptual model to assess nutrient loads (total nitrogen and total phosphorous) from a basin given diffuse and point emissions to the land and river network. The model comprises two major nutrient pathways: diffuse sources that undergo retention in the land phase (basin retention) before reaching the stream, and point sources that are directly discharged into surface waters. Once in the river network, all sources are reduced by the in-stream retention (river retention).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of GREENeR from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"calfarog/GREENeR"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="illustrative-example">Illustrative Example<a class="anchor" aria-label="anchor" href="#illustrative-example"></a>
</h2>
<p>This is a basic example which shows how GREENeR works, for a more detailed illustration, please see our <a href="https://calfarog.github.io/GREENeR/articles/greener_vignette.html" class="external-link">vignettes</a>.</p>
<p>GREENeR functionalities are illustrated for the <a href="https://en.wikipedia.org/wiki/Lay_(river)" class="external-link">Lay river</a> basin, in France. Please note that the basin data are extracted from a pan-European dataset (Grizzetti 2021) for the purpose of showing the package tools and the analysis steps for a generic region.</p>
</div>
<div class="section level2">
<h2 id="model-calibration">Model calibration<a class="anchor" aria-label="anchor" href="#model-calibration"></a>
</h2>
<p>The quality of model calibration depends on the quality and number of available observations. To run the calibration process for a scenario (function <strong>calib_green()</strong>), the following settings must be defined:</p>
<ol style="list-style-type: decimal">
<li><p>The expected range for each parameter. This range is defined by two vectors of three values, one for the lower limits and one for the upper limits of the three parameters. The values correspond to each of the parameters of the model in sequence: alpha_P, alpha_L, and sd_coeff.</p></li>
<li><p>The number of iterations to be performed during the calibration process. The higher the number of iterations, the more likely it is to achieve quality parameters, but the longer the computation time required. Although it depends on the catchment and the proposed intervals, it is recommended to run at least 200 iterations to have enough information to continue the calibration process.</p></li>
<li><p>The years to be included in the calibration process.</p></li>
</ol>
<p>This is a basic example which shows you how to solve a common problem:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/calfarog/GREENeR" class="external-link">GREENeR</a></span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'xts':</span>
<span class="co">#&gt;   method     from</span>
<span class="co">#&gt;   as.zoo.xts zoo</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"catch_data_TN"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"annual_data_TN"</span><span class="op">)</span>

<span class="co"># Parameter for the calibration of the model</span>
<span class="co"># the lower limits for all params (alpha_P, alpha_L, sd_coef)</span>
<span class="va">low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.000</span>, <span class="fl">0.1</span><span class="op">)</span> 
<span class="co"># the upper limits for all params (alpha_P, alpha_L, sd_coef)  </span>
<span class="va">upp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">0.08</span>, <span class="fl">0.9</span><span class="op">)</span>       

<span class="co"># number of iterations</span>
<span class="va">n_iter</span> <span class="op">&lt;-</span> <span class="fl">2000</span>    

<span class="co"># years in which the model should be executed</span>
<span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2003</span><span class="op">:</span><span class="fl">2009</span><span class="op">)</span></code></pre></div>
<p>A calibration of TN in the Lay basin is performed with the parameters indicated above. The process is parallelised and will use all the cores of the computer. The computation time depends on the computer, the basin, and the number of iterations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># execution of the calibration  </span>
<span class="va">DF_calib_TN</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calib_green.html">calib_green</a></span><span class="op">(</span><span class="va">catch_data_TN</span>, <span class="va">annual_data_TN</span>, <span class="va">n_iter</span>, <span class="va">low</span>, <span class="va">upp</span>, <span class="va">years</span><span class="op">)</span></code></pre></div>
<p>The calibration function applies a Latin Hypercube sampling scheme to the three parameters within the possible range (defined by lower and upper limits) and evaluates model performance (predictions against available observations) for the calibration period (specified in ‘years’) by calculating several “goodness-of-fit” metrics. The function returns a dataframe with parameters and goodness-of-fit scores that can be further analyzed.</p>
<p>The function applies the following goodness-of-fit metrics ([@althoff2021goodness]):</p>
<ul>
<li>NSE: Nash-Sutcliffe efficiency</li>
<li>rNSE: Relative Nash-Sutcliffe efficiency</li>
<li>mNSE: Modified Nash-Sutcliffe efficiency</li>
<li>cp: Coefficient of Persistence</li>
<li>VE: Volumetric Efficiency</li>
<li>KGE: Kling-Gupta efficiency</li>
<li>d: Index of Agreement</li>
<li>md: Modified index of agreement</li>
<li>rd: Relative Index of Agreement</li>
<li>r: Linear correlation coefficient</li>
<li>R2: Coefficient of determination</li>
<li>PBIAS: Percent bias</li>
<li>MAE: mean absolute error</li>
<li>RMSE: Root mean square error</li>
<li>ME: Mean error</li>
<li>MSE: Mean square error</li>
<li>NRMSE: Normalized Root Mean Square Error</li>
</ul>
</div>
<div class="section level2">
<h2 id="exploring-calibration-results-and-visualization-tools">Exploring calibration results and visualization tools<a class="anchor" aria-label="anchor" href="#exploring-calibration-results-and-visualization-tools"></a>
</h2>
<p>Choosing the right goodness-of-fit metric to select the best set of parameters for a model largely depends on the overall study scope, the area of interest (e.g. high or low load, upper or lower catchment area), and the available observation dataset (size and quality). The library includes a series of functions to examine the calibration results and help select the most suitable set of parameters.</p>
<div class="section level5">
<h5 id="calibration-boxplot">Calibration boxplot<a class="anchor" aria-label="anchor" href="#calibration-boxplot"></a>
</h5>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generating the box plots  </span>
<span class="va">rateBS</span> <span class="op">&lt;-</span>  <span class="fl">5</span>  <span class="co">#  percent of parameters selected from the whole calibration set</span>
<span class="fu"><a href="reference/calib_boxplot.html">calib_boxplot</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">rateBS</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/calibration_boxplotTN.png" width="100%"></p>
</div>
<div class="section level5">
<h5 id="calibration-dot-plot">Calibration dot plot<a class="anchor" aria-label="anchor" href="#calibration-dot-plot"></a>
</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generating the dot plots  </span>
<span class="va">Gof_mes</span> <span class="op">&lt;-</span> <span class="st">"NSE"</span>
<span class="fu"><a href="reference/calib_dot.html">calib_dot</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">Gof_mes</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/calibration_dotTN.png" width="100%"></p>
</div>
<div class="section level5">
<h5 id="calibration-scatter-plot">Calibration scatter plot<a class="anchor" aria-label="anchor" href="#calibration-scatter-plot"></a>
</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generating the scatter plots  </span>
<span class="va">Gof_mes</span> <span class="op">&lt;-</span> <span class="st">"NSE"</span>
<span class="fu"><a href="reference/scatter_plot.html">scatter_plot</a></span><span class="op">(</span><span class="va">DF_calib_TN</span>, <span class="va">Gof_mes</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/calibration_scatterTN.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Grizzetti, B. and Vigiak, O. and Udias, A. and Aloe, A. and Zanni, M. and Bouraoui, F. and Pistocchi, A. and Dorati, C. and Friedland, R. and De Roo, A. and others (2021). How EU policies could reduce nutrient pollution in European inland and coastal waters. Global Environmental Change, 69, 102281. <a href="https://doi.org/10.1016/j.gloenvcha.2021.102281" class="external-link uri">https://doi.org/10.1016/j.gloenvcha.2021.102281</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/calfarog/GREENeR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/calfarog/GREENeR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing GREENeR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>A. Udias <br><small class="roles"> Author </small>  </li>
<li>B. Grizzetti <br><small class="roles"> Author </small>  </li>
<li>O. Vigiak <br><small class="roles"> Author </small>  </li>
<li>J. Gomez <br><small class="roles"> Author </small>  </li>
<li>C. Alfaro <br><small class="roles"> Author, maintainer </small>  </li>
<li>A. Aloe <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.gnu.org/licenses/gpl-3.0" class="external-link"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by A. Udias, B. Grizzetti, O. Vigiak, J. Gomez, C. Alfaro, A. Aloe.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
